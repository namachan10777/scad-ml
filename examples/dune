(executables
 (names
  rounded_text
  wave_cylinder
  spiral
  rounded_linear_extrude
  rounded_polyhole_sweep
  helix_extrude
  bezier_path
  cartesian_gravity_well
  spline
  poly2d_to_scad
  rounded_prism_pointy
  poly_linear_extrude
  arc_points_2d
  arc_points_3d
  ragged_tri_array_mesh
  polar_rose
  sweep_path
  offset_poly
  axial_chalice
  polyholes
  helix_sweep
  resampled_path
  sweep_starburst
  circular_rounding
  rounded_prism_tunnel
  helix_path_points)
 (libraries scad_ml))

(alias
 (name examples)
 (deps
  (glob_files "*.exe")))

; TODO: make a bash script tailored for this rather than having the long string here

; Convenience rule/alias for building and running examples (output to things diectory)
; This pattern enables automatic scad re-generation on changes with `dune build -w @run`.

; (rulexamples/e
;  (alias run)
;  (deps
;   (glob_files "*.exe"))
;  (action
;   (bash
;    "cd $(dirname $(dirname $INSIDE_DUNE)); mkdir -p things; cd things; for ex in $INSIDE_DUNE/examples/*.exe; do eval $ex; done")))

(rule
 (alias run)
 (deps
  (glob_files "*.exe"))
 ; (targets "things")
 (targets
  (dir "things"))
 (mode
  (promote (until-clean)))
 (action
  (chdir
   "things"
   (bash "for ex in $INSIDE_DUNE/examples/*.exe; do eval $ex; done"))))
